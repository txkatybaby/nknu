<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Nknu by txkatybaby</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Nknu</h1>
      <h2 class="project-tagline">Inhavenoidea</h2>
      <a href="https://github.com/txkatybaby/nknu" class="btn">View on GitHub</a>
      <a href="https://github.com/txkatybaby/nknu/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/txkatybaby/nknu/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="include--------for-dynamic-loading-" class="anchor" href="#include--------for-dynamic-loading-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include       /* For dynamic loading */</h1>

<h1>
<a id="include-" class="anchor" href="#include-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include </h1>

<h1>
<a id="include--1" class="anchor" href="#include--1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include </h1>

<h1>
<a id="include--2" class="anchor" href="#include--2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include </h1>

<h1>
<a id="include--3" class="anchor" href="#include--3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include </h1>

<p>/* #include "OMX_RegLib.h" */</p>

<h1>
<a id="include-omx_componenth" class="anchor" href="#include-omx_componenth" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include "OMX_Component.h"</h1>

<h1>
<a id="include-omx_coreh" class="anchor" href="#include-omx_coreh" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include "OMX_Core.h"</h1>

<h1>
<a id="include-omx_componentregistryh" class="anchor" href="#include-omx_componentregistryh" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include "OMX_ComponentRegistry.h"</h1>

<h1>
<a id="include-timm_osal_typesh" class="anchor" href="#include-timm_osal_typesh" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include "timm_osal_types.h"</h1>

<h1>
<a id="include-timm_osal_errorh" class="anchor" href="#include-timm_osal_errorh" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include "timm_osal_error.h"</h1>

<h1>
<a id="include-timm_osal_traceh" class="anchor" href="#include-timm_osal_traceh" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include "timm_osal_trace.h"</h1>

<h1>
<a id="include-timm_osal_mutexh" class="anchor" href="#include-timm_osal_mutexh" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include "timm_osal_mutex.h"</h1>

<h1>
<a id="ifdef-check_secure_state" class="anchor" href="#ifdef-check_secure_state" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ifdef CHECK_SECURE_STATE</h1>

<h1>
<a id="include--4" class="anchor" href="#include--4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include </h1>

<h1>
<a id="include--5" class="anchor" href="#include--5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include </h1>

<h1>
<a id="include--6" class="anchor" href="#include--6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>include </h1>

<h1>
<a id="endif" class="anchor" href="#endif" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>endif</h1>

<p>/** size for the array of allocated components.  Sets the maximum</p>

<ul>
<li>number of components that can be allocated at once */
#define MAXCOMP (50)
#define MAXNAMESIZE (128)
#define EMPTY_STRING "\0"</li>
</ul>

<p>/** Determine the number of elements in an array */</p>

<h1>
<a id="define-countofx-sizeofxsizeofx0" class="anchor" href="#define-countofx-sizeofxsizeofx0" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>define COUNTOF(x) (sizeof(x)/sizeof(x[0]))</h1>

<p>/** Array to hold the DLL pointers for each allocated component */
static void *pModules[MAXCOMP] = { 0 };</p>

<p>/** Array to hold the component handles for each allocated component */
static void *pComponents[COUNTOF(pModules)] = { 0 };</p>

<p>/* count for call OMX_Init() */
int count = 0;
pthread_mutex_t mutex;
TIMM_OSAL_PTR pCoreInitMutex = NULL;</p>

<p>int tableCount = 0;
ComponentTable componentTable[MAX_TABLE_SIZE];
char *sRoleArray[60][20];
char compName[60][200];</p>

<p>char <em>tComponentName[MAXCOMP][MAX_ROLES] = {
    /</em>video and image components <em>/
    {"OMX.TI.DUCATI1.VIDEO.DECODER", "video_decoder.mpeg4",
        "video_decoder.avc",
        "video_decoder.h263",
        "video_decoder.wmv",
        "video_decoder.vp6",
        "video_decoder.vp7", NULL},
    {"OMX.TI.DUCATI1.VIDEO.DECODER.secure", "video_decoder.mpeg4",
        "video_decoder.avc",
        "video_decoder.h263", NULL},
    {"OMX.TI.DUCATI1.VIDEO.H264D",  "video_decoder.avc", NULL},
    {"OMX.TI.DUCATI1.VIDEO.H264E",  "video_encoder.avc", NULL},
    {"OMX.TI.DUCATI1.VIDEO.MPEG4D", "video_decoder.mpeg4", NULL},
    {"OMX.TI.DUCATI1.VIDEO.MPEG4E", "video_encoder.mpeg4",
                                    "video_encoder.h263",NULL},
    {"OMX.TI.DUCATI1.VIDEO.VP6D",   "video_decoder.vp6", NULL},
    {"OMX.TI.DUCATI1.VIDEO.VP7D",   "video_decoder.vp7", NULL},
    {"OMX.TI.DUCATI1.IMAGE.JPEGD",  "jpeg_decoder.jpeg", NULL},
    {"OMX.TI.DUCATI1.VIDEO.CAMERA",  "camera.omx", NULL},
    /</em> terminate the table */
    {NULL, NULL},
};</p>

<p>//AD
extern OMX_ERRORTYPE OMX_ComponentInit(OMX_HANDLETYPE hComponent);</p>

<h1>
<a id="define-core_assert--core_paramcheck" class="anchor" href="#define-core_assert--core_paramcheck" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>define CORE_assert  CORE_paramCheck</h1>

<h1>
<a id="define-core_require-core_paramcheck" class="anchor" href="#define-core_require-core_paramcheck" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>define CORE_require CORE_paramCheck</h1>

<h1>
<a id="define-core_ensure--core_paramcheck" class="anchor" href="#define-core_ensure--core_paramcheck" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>define CORE_ensure  CORE_paramCheck</h1>

<h1>
<a id="define-core_paramcheckc-v-s-do-" class="anchor" href="#define-core_paramcheckc-v-s-do-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>define CORE_paramCheck(C, V, S) do {\</h1>

<pre><code>if (!(C)) { eError = V;\
TIMM_OSAL_Error("failed check: " #C);\
TIMM_OSAL_Error(" - returning error: " #V);\
if(S) TIMM_OSAL_Error(" - %s", S);\
goto EXIT; }\
} while(0)
</code></pre>

<p>/***************************<strong><em>Public</em>Routine</strong>****************************\</p>

<ul>
<li>OMX_Init()
*</li>
<li>Description:This method will initialize the OMX Core.  It is the</li>
<li>responsibility of the application to call OMX_Init to ensure the proper</li>
<li>set up of core resources.
*</li>
<li>Returns:    OMX_NOERROR          Successful
*</li>
<li>
<p>Note
*
**************************************************************************/
OMX_ERRORTYPE OMX_Init()
{
OMX_ERRORTYPE eError = OMX_ErrorNone;
TIMM_OSAL_ERRORTYPE eOsalError = TIMM_OSAL_ERR_NONE;</p>

<p>eOsalError = TIMM_OSAL_MutexObtain(pCoreInitMutex, TIMM_OSAL_SUSPEND);
CORE_assert(eOsalError == TIMM_OSAL_ERR_NONE,
    OMX_ErrorInsufficientResources, "Mutex lock failed");</p>

<p>count++;</p>

<p>if (count == 1)
{
    pthread_mutex_init(&amp;mutex, NULL);
    eError = OMX_BuildComponentTable();
}</p>

<p>eOsalError = TIMM_OSAL_MutexRelease(pCoreInitMutex);
CORE_assert(eOsalError == TIMM_OSAL_ERR_NONE,
    OMX_ErrorInsufficientResources, "Mutex release failed");
  EXIT:
return eError;
}</p>
</li>
</ul>

<p>/***************************<strong><em>Public</em>Routine</strong>****************************\</p>

<ul>
<li>OMX_GetHandle
*</li>
<li>Description: This method will create the handle of the COMPONENTTYPE</li>
<li>If the component is currently loaded, this method will reutrn the</li>
<li>hadle of existingcomponent or create a new instance of the component.</li>
<li>It will call the OMX_ComponentInit function and then the setcallback</li>
<li>method to initialize the callback functions</li>
<li>Parameters:</li>
<li>
<a href="https://github.com/param" class="user-mention">@param</a>[out] pHandle            Handle of the loaded components</li>
<li>
<a href="https://github.com/param" class="user-mention">@param</a>[in] cComponentName     Name of the component to load</li>
<li>
<a href="https://github.com/param" class="user-mention">@param</a>[in] pAppData           Used to identify the callbacks of component</li>
<li>
<a href="https://github.com/param" class="user-mention">@param</a>[in] pCallBacks         Application callbacks
*</li>
<li>
<a href="https://github.com/retval" class="user-mention">@retval</a> OMX_ErrorUndefined</li>
<li>
<a href="https://github.com/retval" class="user-mention">@retval</a> OMX_ErrorInvalidComponentName</li>
<li>
<a href="https://github.com/retval" class="user-mention">@retval</a> OMX_ErrorInvalidComponent</li>
<li>
<a href="https://github.com/retval" class="user-mention">@retval</a> OMX_ErrorInsufficientResources</li>
<li>
<a href="https://github.com/retval" class="user-mention">@retval</a> OMX_NOERROR                      Successful
*</li>
<li>Note
*
**************************************************************************/</li>
</ul>

<p>OMX_ERRORTYPE OMX_GetHandle(OMX_HANDLETYPE * pHandle,
    OMX_STRING cComponentName, OMX_PTR pAppData,
    OMX_CALLBACKTYPE * pCallBacks)
{
    static const char prefix[] = "lib";
    static const char postfix[] = ".so";
    OMX_ERRORTYPE(*pComponentInit) (OMX_HANDLETYPE *);
    OMX_ERRORTYPE eError = OMX_ErrorNone;
    OMX_COMPONENTTYPE *componentType;
    int i;
    char buf[sizeof(prefix) + MAXNAMESIZE + sizeof(postfix)];
    const char *pErr = dlerror();
    char *dlError = NULL;</p>

<h1>
<a id="ifdef-check_secure_state-1" class="anchor" href="#ifdef-check_secure_state-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ifdef CHECK_SECURE_STATE</h1>

<pre><code>    int secure_misc_drv_fd,ret;
    OMX_U8 mode, enable=1;
</code></pre>

<h1>
<a id="endif-1" class="anchor" href="#endif-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>endif</h1>

<pre><code>if (pthread_mutex_lock(&amp;mutex) != 0)
{
    TIMM_OSAL_Error("Core: Error in Mutex lock");
}

CORE_require(NULL != cComponentName, OMX_ErrorBadParameter, NULL);
CORE_require(NULL != pHandle, OMX_ErrorBadParameter, NULL);
CORE_require(NULL != pCallBacks, OMX_ErrorBadParameter, NULL);
CORE_require(count &gt; 0, OMX_ErrorUndefined,
    "OMX_GetHandle called without calling OMX_Init first");

/* Verify that the name is not too long and could cause a crash.  Notice
 * that the comparison is a greater than or equals.  This is to make
 * sure that there is room for the terminating NULL at the end of the
 * name. */
CORE_require(strlen(cComponentName) &lt; MAXNAMESIZE,
    OMX_ErrorInvalidComponentName, NULL);

/* Locate the first empty slot for a component.  If no slots
 * are available, error out */
for (i = 0; i &lt; COUNTOF(pModules); i++)
{
    if (pModules[i] == NULL)
        break;
}
CORE_assert(i != COUNTOF(pModules), OMX_ErrorInsufficientResources,
    NULL);

/* load the component and check for an error.  If filename is not an
 * absolute path (i.e., it does not  begin with a "/"), then the
 * file is searched for in the following locations:
 *
 *     The LD_LIBRARY_PATH environment variable locations
 *     The library cache, /etc/ld.so.cache.
 *     /lib
 *     /usr/lib
 *
 * If there is an error, we can't go on, so set the error code and exit */
strcpy(buf, prefix);    /* the lengths are defined herein or have been */
strcat(buf, cComponentName);    /* checked already, so strcpy and strcat are  */
strcat(buf, postfix);   /* are safe to use in this context. */
</code></pre>

<h1>
<a id="ifdef-check_secure_state-2" class="anchor" href="#ifdef-check_secure_state-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ifdef CHECK_SECURE_STATE</h1>

<pre><code>    //Dont return errors from misc driver to the user if any.
    //Since this affects all usecases, secure and non-secure.
    //Do log the errors though.
    secure_misc_drv_fd = open("/dev/rproc_user", O_SYNC | O_RDONLY);
if (secure_misc_drv_fd &lt; 0)
{
    TIMM_OSAL_Error("Can't open misc driver device 0x%x\n", errno);
}

ret = read(secure_misc_drv_fd, &amp;mode, sizeof(mode));
if (ret &lt; 0)
{
    TIMM_OSAL_Error("Can't read from the misc driver");
}
    if(mode == enable &amp;&amp; strstr(cComponentName,"secure") == NULL)
{
    TIMM_OSAL_Error("non-secure component not supported in secure mode");
    eError = OMX_ErrorComponentNotFound;
}
ret = close(secure_misc_drv_fd);
if (ret &lt; 0)
{
    TIMM_OSAL_Error("Can't close the misc driver");
}
    //Dont allow non-secure usecases if we are in secure state.
    //Else some of the memory regions will be unexpected firewalled.
    //This provides a clean exit in case we are in secure mode.
    if(eError == OMX_ErrorComponentNotFound)
    {
            goto EXIT;
    }
</code></pre>

<hr>

<h3>
<a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Welcome to GitHub Pages.</h3>

<p>This automatic page generator is the easiest way to create beautiful pages for all of your projects. Author your page content here <a href="https://guides.github.com/features/mastering-markdown/">using GitHub Flavored Markdown</a>, select a template crafted by a designer, and publish. After your page is generated, you can check out the new <code>gh-pages</code> branch locally. If you’re using GitHub Desktop, simply sync your repository and you’ll see the new branch.</p>

<h3>
<a id="designer-templates" class="anchor" href="#designer-templates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Designer Templates</h3>

<p>We’ve crafted some handsome templates for you to use. Go ahead and click 'Continue to layouts' to browse through them. You can easily go back to edit your page before publishing. After publishing your page, you can revisit the page generator and switch to another theme. Your Page content will be preserved.</p>

<h3>
<a id="creating-pages-manually" class="anchor" href="#creating-pages-manually" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating pages manually</h3>

<p>If you prefer to not use the automatic generator, push a branch named <code>gh-pages</code> to your repository to create a page manually. In addition to supporting regular HTML content, GitHub Pages support Jekyll, a simple, blog aware static site generator. Jekyll makes it easy to create site-wide headers and footers without having to copy them across every page. It also offers intelligent blog support and other advanced templating features.</p>

<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>You can <a href="https://help.github.com/articles/basic-writing-and-formatting-syntax/#mentioning-users-and-teams" class="user-mention">@mention</a> a GitHub username to generate a link to their profile. The resulting <code>&lt;a&gt;</code> element will link to the contributor’s GitHub Profile. For example: In 2007, Chris Wanstrath (<a href="https://github.com/defunkt" class="user-mention">@defunkt</a>), PJ Hyett (<a href="https://github.com/pjhyett" class="user-mention">@pjhyett</a>), and Tom Preston-Werner (<a href="https://github.com/mojombo" class="user-mention">@mojombo</a>) founded GitHub.</p>

<h3>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Support or Contact</h3>

<p>Having trouble with Pages? Check out our <a href="https://help.github.com/pages">documentation</a> or <a href="https://github.com/contact">contact support</a> and we’ll help you sort it out.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/txkatybaby/nknu">Nknu</a> is maintained by <a href="https://github.com/txkatybaby">txkatybaby</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
